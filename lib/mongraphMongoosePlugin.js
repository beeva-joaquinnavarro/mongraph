// Generated by CoffeeScript 1.6.2
var exports, mongraphMongoosePlugin;

module.exports = exports = mongraphMongoosePlugin = function(schema, options) {
  var _base, _base1, _ref, _ref1, _ref2, _ref3;

  if (options == null) {
    options = {};
  }
  schema.add({
    _node_id: Number
  });
  if ((_ref = options.storeNodeID) == null) {
    options.storeNodeID = true;
  }
  if ((_ref1 = options.relations) == null) {
    options.relations = {};
  }
  if ((_ref2 = (_base = options.relations).removeAllOutgoing) == null) {
    _base.removeAllOutgoing = true;
  }
  if ((_ref3 = (_base1 = options.relations).removeAllIncoming) == null) {
    _base1.removeAllIncoming = true;
  }
  schema.pre('remove', function(errHandler, cb) {
    var opts;

    opts = {
      includeRelationships: options.relations.removeAllOutgoing && options.relations.removeAllOutgoing
    };
    return this.removeNode(opts, cb);
  });
  return schema.pre('save', function(next) {
    var doc;

    doc = this;
    if (options.storeNodeID !== true) {
      return next();
    }
    return doc.getNode({
      forceCreation: true
    }, function(err, node) {
      return next();
    });
  });
};
